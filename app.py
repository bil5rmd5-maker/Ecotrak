import streamlit as st
import pandas as pd
import numpy as np
import plotly.express as px

# 1. ุฅุนุฏุงุฏุงุช ุงูููุตุฉ
st.set_page_config(page_title="Ecotrak Smart Advisor", layout="wide", page_icon="๐ก")

# 2. ุชููุฆุฉ ุงูุจูุงูุงุช
if 'products_df' not in st.session_state:
    st.session_state.products_df = pd.DataFrame([
        {'product_name': 'ุชูุฑุจููุงุช ููุฑุจุงุฆูุฉ', 'daily_sales': 12, 'stock': 45, 'price': 8000, 'order_cost': 1200, 'holding_cost': 200, 'lead_time': 10},
        {'product_name': 'ููุญุงุช ุชุญูู', 'daily_sales': 35, 'stock': 120, 'price': 1500, 'order_cost': 300, 'holding_cost': 45, 'lead_time': 5}
    ])

# --- ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ---
st.sidebar.title("๐ Ecotrak AI Advisor")
menu = st.sidebar.radio("ุงูููุงุฆู:", ["๐ ููุญุฉ ุงููุฑุงุกุงุช", "๐๏ธ ุงููุญุงูู ุงูุฐูู", "๐ ุงูููุฑุฏูู", "๐ฑ ุงูุงุณุชุฏุงูุฉ"])

# --- ุงููุงุฆูุฉ 1: ููุญุฉ ุงููุฑุงุกุงุช ูุน ุชุญููู ููุฑู ---
if menu == "๐ ููุญุฉ ุงููุฑุงุกุงุช":
    st.header("๐ ุญุงูุฉ ุงููุฎุฒูู ุงูุญุงููุฉ")
    selected_p = st.selectbox("ุงุฎุชุฑ ุงูููุชุฌ:", st.session_state.products_df['product_name'].unique())
    p_data = st.session_state.products_df[st.session_state.products_df['product_name'] == selected_p].iloc[0]
    
    # ุญุณุงุจุงุช
    days_left = p_data['stock'] / p_data['daily_sales']
    
    col1, col2 = st.columns([2, 1])
    with col1:
        st.metric("ุฃูุงู ุงูุชุบุทูุฉ ุงููุชุจููุฉ", f"{int(days_left)} ููู")
        st.progress(min(days_left/30, 1.0))
    
    st.markdown("---")
    # --- ูุญุฑู ุงููุตุงุฆุญ (Decision Logic) ---
    st.subheader("๐ค ุชุญููู ุงููุณุชุดุงุฑ ูููุถุน ุงูุญุงูู:")
    if days_left <= p_data['lead_time']:
        st.error(f"โ๏ธ **ุงูุชุญููู:** ุงููุฎุฒูู ุงูุญุงูู ({p_data['stock']}) ุณูููุฏ ูุจู ูุตูู ุงูุดุญูุฉ ุงูุฌุฏูุฏุฉ.")
        st.write(f"๐ **ุงููุฑุงุฑ ุงูุฃูุถู:** ุงุทูุจ ุงูุขู ุดุญูุฉ ุทุงุฑุฆุฉ ููุง ุชูุชุธุฑ. ููุง ูููุถู ุฑูุน 'ูุฎุฒูู ุงูุฃูุงู' ููุฐุง ุงูููุชุฌ ุจูุณุจุฉ 20%.")
    elif days_left > 45:
        st.warning(f"โ๏ธ **ุงูุชุญููู:** ูุฏูู ูุงุฆุถ ูุจูุฑ (ุชุบุทูุฉ ูู {int(days_left)} ููู).")
        st.write(f"๐ **ุงููุฑุงุฑ ุงูุฃูุถู:** ุชููู ุนู ุงูุทูุจ ุญุงููุงู. ุฃูุช ุชุฎุณุฑ ุฃููุงูุงู ูู 'ุชูุงููู ุงูุชุฎุฒูู' ูููู ุงุณุชุซูุงุฑูุง ูู ููุชุฌุงุช ุฃุฎุฑู ุฃุณุฑุน ุฏูุฑุงูุงู.")
    else:
        st.success(f"โ **ุงูุชุญููู:** ูุถุนู ุงูููุฌุณุชู ูุซุงูู ุญุงููุงู.")
        st.write(f"๐ **ุงููุฑุงุฑ ุงูุฃูุถู:** ุงุณุชูุฑ ุนูู ูุฐุง ุงููููุงู ูุฑุงูุจ ูุชูุณุท ุงูุณุญุจ ุงูุฃุณุจูุนู ููุท.")

# --- ุงููุงุฆูุฉ 2: ุงููุญุงูู ุงูุฐูู ูุน ุชุญููู "ูุงุฐุง ูู" ---
elif menu == "๐๏ธ ุงููุญุงูู ุงูุฐูู":
    st.header("๐๏ธ ูุญุงูู ุงูุญุณุงุณูุฉ ูุฏุฑุงุณุฉ ุงูุฃุซุฑ")
    selected_p = st.selectbox("ููุชุฌ ุงููุญุงูุงุฉ:", st.session_state.products_df['product_name'].unique())
    p_data = st.session_state.products_df[st.session_state.products_df['product_name'] == selected_p].iloc[0]
    
    sim_price = st.slider("ุชุนุฏูู ุงูุณุนุฑ ุงููุฎุทุท ูู", int(p_data['price']*0.5), int(p_data['price']*1.5), int(p_data['price']))
    
    # ุญุณุงุจ ุงูุฃุซุฑ
    price_diff = ((sim_price / p_data['price']) - 1) * 100
    expected_sales = p_data['daily_sales'] / ((sim_price / p_data['price']) ** 1.2)
    
    st.markdown("---")
    st.subheader("๐ก ุจูุงุกู ุนูู ุชุนุฏูู ุงูุณุนุฑ ุงููุฎุชุงุฑ:")
    if price_diff < 0:
        st.success(f"๐ **ุงูุฃุซุฑ ุงููุชููุน:** ุฎูุถ ุงูุณุนุฑ ุจูุณุจุฉ {abs(price_diff):.1f}% ุณูุฑูุน ุงููุจูุนุงุช ุฅูู {expected_sales:.1f} ูุทุนุฉ ููููุงู.")
        st.write(f"๐ฉ **ุชูุจูู:** ุณุชุญุชุงุฌ ูุฒูุงุฏุฉ ุณุนุฉ ุงููุณุชูุฏุน ุฃู ุชุณุฑูุน ูุชูุฑุฉ ุงูุทูุจ ูู ุงูููุฑุฏูู ุจูุณุจุฉ {((expected_sales/p_data['daily_sales'])-1)*100:.1f}% ูุชุฌูุจ ุงูููุงุฏ.")
    elif price_diff > 0:
        st.error(f"๐ **ุงูุฃุซุฑ ุงููุชููุน:** ุฑูุน ุงูุณุนุฑ ุจูุณุจุฉ {price_diff:.1f}% ูุฏ ูุคุฏู ูุฑููุฏ ุฌุฒุฆู ูุงูุฎูุงุถ ุงููุจูุนุงุช.")
        st.write(f"๐ **ูุตูุญุฉ:** ุฅุฐุง ูุฑุฑุช ุฑูุน ุงูุณุนุฑุ ูุฌุจ ุนููู ุชูููู 'ูููุฉ ุงูุทูุจ ุงูุงูุชุตุงุฏูุฉ (EOQ)' ููุฑุงู ููู ูุง ุชุชูุฏุณ ุงูุจุถุงุนุฉ ูุชุตุจุญ 'ูุฎุฒููุงู ููุชุงู'.")

# --- ุงููุงุฆูุฉ 3: ุงูููุฑุฏูู ูุน ุชุญููู ุงูููุงุถูุฉ ---
elif menu == "๐ ุงูููุฑุฏูู":
    st.header("๐ ุฑุงุฏุงุฑ ุงุฎุชูุงุฑ ุงูููุฑุฏ")
    v_time = st.select_slider("ุงุฎุชุฑ ุณุฑุนุฉ ุงูุชูุตูู ุงููุทููุจุฉ", options=["ุณุฑูุน ุฌุฏุงู (3 ุฃูุงู)", "ูุชูุณุท (8 ุฃูุงู)", "ุจุทูุก (20 ููู)"])
    
    st.markdown("---")
    st.subheader("โ๏ธ ุชุญููู ุงูููุงุถูุฉ (Trade-off):")
    if "ุณุฑูุน" in v_time:
        st.write("โ **ุงูููุฒุฉ:** ุชูููู ูุฎุงุทุฑ ููุงุฏ ุงููุฎุฒูู ูุชูููู ุงูุญุงุฌุฉ ููุฎุฒูู ุฃูุงู ุถุฎู.")
        st.write("โ **ุงูุนูุจ:** ุณุชุชุญูู ุชูุงููู ุดุญู ุนุงููุฉ ุฌุฏุงู (S)ุ ููุง ูููู ุตุงูู ุฑุจุญ ุงููุญุฏุฉ.")
    else:
        st.write("โ **ุงูููุฒุฉ:** ุชูููุฑ ูุงุฆู ูู ุชูุงููู ุงูููุฌุณุชูุงุช (ุชูููุฑ ูุงูู).")
        st.write("โ๏ธ **ุงูุฎุทุฑ:** ุฃู ุชุฃุฎูุฑ ุจุณูุท ูู ุงูููุฑุฏ ุณูุคุฏู ูุชููู ุฎุท ุงูุฅูุชุงุฌ ุจุงููุงูู.")

# --- ุงููุงุฆูุฉ 4: ุงูุงุณุชุฏุงูุฉ ูุน ุชุญููู ุงูุฃุซุฑ ุงูุจูุฆู ---
elif menu == "๐ฑ ุงูุงุณุชุฏุงูุฉ":
    st.header("๐ฑ ุชูุฑูุฑ ุงูุงุณุชุฏุงูุฉ")
    # (ููุง ูุถุน ุญุณุงุจุงุช ุงูุงุณุชุฏุงูุฉ ุงูุณุงุจูุฉ)
    st.info("ูุธุงู Ecotrak ูุณุงุนุฏู ุนูู ุงุฎุชูุงุฑ 'ุงููููุฉ ุงูุงูุชุตุงุฏูุฉ' ุงูุชู ุชููู ุนุฏุฏ ุฑุญูุงุช ุงูุดุญูุ ููุง ูููู ุงูุจุตูุฉ ุงููุฑุจูููุฉ ูููุตูุน ุจูุณุจุฉ 18%.")
