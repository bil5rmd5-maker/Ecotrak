
import streamlit as st
import pandas as pd
import numpy as np
import plotly.express as px

st.set_page_config(page_title="Ecotrak Pro AI", layout="wide", page_icon="ğŸš€")

# ÙˆØ§Ø¬Ù‡Ø© Ù…Ø³ØªØ®Ø¯Ù… Ø§Ø­ØªØ±Ø§ÙÙŠØ©
st.title("ğŸš€ Ecotrak AI: Ù†Ø¸Ø§Ù… Ø¯Ø¹Ù… Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„Ù„Ø­Ø¸ÙŠ")
st.markdown("---")

# ÙˆØ¸ÙŠÙØ© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
def get_default_data():
    data = {
        'Product': ['Ù…Ù†ØªØ¬ A', 'Ù…Ù†ØªØ¬ B', 'Ù…Ù†ØªØ¬ C'],
        'Sales': [25, 10, 50],
        'Stock': [150, 40, 300],
        'Cost_S': [100, 250, 80], # ØªÙƒÙ„ÙØ© Ø§Ù„Ø·Ù„Ø¨
        'Cost_H': [5, 15, 2],    # ØªÙƒÙ„ÙØ© Ø§Ù„ØªØ®Ø²ÙŠÙ†
        'Price': [150, 1200, 45] # Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹
    }
    return pd.DataFrame(data)

df = get_default_data()

# --- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ---
st.sidebar.header("ğŸ› ï¸ ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª")
selected_p = st.sidebar.selectbox("Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬ Ù„ØªØ¬Ø±Ø¨ØªÙ‡:", df['Product'])

# Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù…Ø®ØªØ§Ø±
row = df[df['Product'] == selected_p].iloc[0]

st.sidebar.markdown("---")
st.sidebar.subheader("ğŸ“‰ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø·ÙŠØ§Øª (ØªÙØ§Ø¹Ù„ÙŠ)")
# Ù‡Ù†Ø§ Ø§Ù„Ø³Ø±: Ø£Ø´Ø±Ø·Ø© ØªØ­ÙƒÙ… Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙˆØ±Ø§Ù‹
price = st.sidebar.slider("Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø±ÙŠØ§Ù„)", 10, 2000, int(row['Price']))
daily_sales = st.sidebar.slider("Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ (Ù‚Ø·Ø¹Ø©)", 1, 100, int(row['Sales']))
order_cost = st.sidebar.slider("ØªÙƒÙ„ÙØ© Ø§Ù„Ø´Ø­Ù† ÙˆØ§Ù„Ø·Ù„Ø¨ (S)", 50, 1000, int(row['Cost_S']))
holding_cost = st.sidebar.slider("ØªÙƒÙ„ÙØ© ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù‚Ø·Ø¹Ø© (H)", 1, 100, int(row['Cost_H']))
current_stock = st.sidebar.number_input("Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹", value=int(row['Stock']))

# --- Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠØ© Ø§Ù„Ù„Ø­Ø¸ÙŠØ© ---
# Ù…Ø¹Ø§Ø¯Ù„Ø© EOQ
eoq = np.sqrt((2 * daily_sales * 365 * order_cost) / holding_cost)
# Ø§Ù„ØªÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø§Ù„ÙŠ
daily_revenue = daily_sales * price
monthly_profit_potential = daily_revenue * 30

# --- Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø¨Ù‡Ø±Ø© ---
col1, col2, col3, col4 = st.columns(4)
col1.metric("Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ", f"{current_stock} Ù‚Ø·Ø¹Ø©")
col2.metric("Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø³Ù†ÙˆÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹", f"{daily_sales * 365} ÙˆØ­Ø¯Ø©")
col3.metric("Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠØ© (EOQ)", f"{int(eoq)} Ù‚Ø·Ø¹Ø©")
col4.metric("Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹", f"{daily_revenue} Ø±ÙŠØ§Ù„")

st.markdown("---")

# Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ ØªÙØ§Ø¹Ù„ÙŠ ÙŠÙˆØ¶Ø­ ØªØ£Ø«ÙŠØ± Ø§Ù„Ø³Ø¹Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ (Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ ØªØ®ÙŠÙ„ÙŠ)
st.subheader("ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø­Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª")
scenario_data = pd.DataFrame({
    'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©': range(1, 101),
    'Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ (Ø±ÙŠØ§Ù„)': [i * price for i in range(1, 101)]
})
fig = px.area(scenario_data, x='Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©', y='Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ (Ø±ÙŠØ§Ù„)', 
              title="ÙƒÙŠÙ Ø³ÙŠØ¤Ø«Ø± ØªØºÙŠÙŠØ± Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø®ØªØ§Ø± Ø¹Ù„Ù‰ Ø¯Ø®Ù„ÙƒØŸ", color_discrete_sequence=['#00CC96'])
st.plotly_chart(fig, use_container_width=True)

# --- Ø§Ù„ØªÙˆØµÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ© Ø§Ù„ØªÙŠ ØªØªØºÙŠØ± Ù…Ø¹ Ø§Ù„Ø£Ø´Ø±Ø·Ø© ---
st.subheader("ğŸ¤– Ù†ØµÙŠØ­Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù„Ø­Ø¸ÙŠØ©")
days_to_zero = current_stock / daily_sales

if days_to_zero <= 3:
    st.error(f"ğŸš¨ **ØªØ­Ø±Ùƒ Ø§Ù„Ø¢Ù†!** Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø³ÙŠÙ†ÙØ¯ Ø®Ù„Ø§Ù„ {days_to_zero:.1f} Ø£ÙŠØ§Ù…. Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ØªÙƒÙ„ÙØ© Ø§Ù„Ø´Ø­Ù† ({order_cost} Ø±ÙŠØ§Ù„)ØŒ Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù† {int(eoq)} Ù‚Ø·Ø¹Ø©.")
elif days_to_zero <= 7:
    st.warning(f"âš ï¸ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙŠÙƒÙÙŠ Ù„Ù€ {days_to_zero:.1f} Ø£ÙŠØ§Ù… ÙÙ‚Ø·. ÙŠÙØ¶Ù„ Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø·Ù„Ø¨.")
else:
    st.success(f"âœ… Ø§Ù„ÙˆØ¶Ø¹ Ø¢Ù…Ù†. Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙŠÙƒÙÙŠ Ù„Ù€ {int(days_to_zero)} ÙŠÙˆÙ…Ø§Ù‹ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©.")

st.info(f"ğŸ’¡ Ù…Ù„Ø§Ø­Ø¸Ø© Ù„Ù„Ù…Ù‡Ù†Ø¯Ø³ÙŠÙ†: ØªÙ‚Ù„ÙŠÙ„ ØªÙƒÙ„ÙØ© Ø§Ù„Ø·Ù„Ø¨ (S) Ø¥Ù„Ù‰ Ø§Ù„Ù†ØµÙ Ø³ÙŠÙ‚Ù„Ù„ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ© Ù„Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø³Ø¨Ø© 30%ØŒ Ù…Ù…Ø§ ÙŠØ²ÙŠØ¯ Ù…Ù† Ø³Ø±Ø¹Ø© Ø¯ÙˆØ±Ø§Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†.")
