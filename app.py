import streamlit as st
import pandas as pd
import numpy as np
import plotly.express as px

# 1. ุฅุนุฏุงุฏุงุช ุงูุตูุญุฉ
st.set_page_config(page_title="Ecotrak AI Advisor", layout="wide", page_icon="๐ค")

st.title("๐ค Ecotrak AI: ุงููุณุชุดุงุฑ ุงูุฐูู ูุณูุงุณู ุงูุฅูุฏุงุฏ")
st.markdown("---")

# 2. ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ููุชูุงุนู
st.sidebar.header("๐๏ธ ููุญุฉ ุงูุชุญูู ุจุงูุชููุนุงุช")
price = st.sidebar.number_input("ุณุนุฑ ุจูุน ุงููุญุฏุฉ (ุฑูุงู)", value=500)
daily_sales = st.sidebar.slider("ูุชูุณุท ุงูุณุญุจ ุงููููู (ูุทุนุฉ)", 1, 100, 25)
order_cost = st.sidebar.number_input("ุชูููุฉ ุงูุดุญู ูุงูุทูุจ (S)", value=150)
holding_cost = st.sidebar.number_input("ุชูููุฉ ุชุฎุฒูู ุงููุทุนุฉ (H)", value=10)
current_stock = st.sidebar.number_input("ุงููุฎุฒูู ุงููุนูู ุงูุญุงูู", value=100)

# 3. ุงูุญุณุงุจุงุช ุงูููุฏุณูุฉ (Logic)
# ูุนุงุฏูุฉ ุงููููุฉ ุงูุงูุชุตุงุฏูุฉ
eoq = np.sqrt((2 * daily_sales * 365 * order_cost) / holding_cost)
# ุญุณุงุจ ุฃูุงู ุงูุชุบุทูุฉ
days_left = current_stock / daily_sales
# ุญุณุงุจ ุงูุฎุณุงุฑุฉ ุงููุญุชููุฉ ูู ุญุงู ููุงุฏ ุงููุฎุฒูู
potential_loss = (daily_sales * price) * 5  # ุฎุณุงุฑุฉ 5 ุฃูุงู ุนูู

# 4. ุนุฑุถ ุงูุฃุฑูุงู ุงูุฑุฆูุณูุฉ
c1, c2, c3 = st.columns(3)
c1.metric("ูุฎุฒููู ูููู ููุฏุฉ", f"{int(days_left)} ุฃูุงู")
c2.metric("ุงููููุฉ ุงููุซุงููุฉ ููุทูุจ (EOQ)", f"{int(eoq)} ูุทุนุฉ")
c3.metric("ุงูุฏุฎู ุงููููู", f"{daily_sales * price} ุฑูุงู")

st.markdown("---")

# 5. ูุณู ุชุญููู ุงูุฃุณุจุงุจ ูุงูุญููู (ุงููุณุชุดุงุฑ ุงูุฐูู)
st.subheader("๐ง ุชุญููู ุงููุณุชุดุงุฑ ุงูุฐูู ูููุถุน ุงูุญุงูู")

col_analysis, col_solutions = st.columns(2)

with col_analysis:
    st.markdown("### ๐ ููุงุฐุง ูุฐุง ุงููุถุนุ")
    if days_left < 3:
        st.error(f"**ุณุจุจ ุงูุฎุทุฑ:** ุงูุณุญุจ ุงููููู ุงูุนุงูู ({daily_sales}) ููุงุจู ูุฎุฒูู ููุฎูุถ ุฌุฏุงู.")
        st.write(f"**ุงูุฃุซุฑ ุงููุงูู:** ุฃูุช ููุฏุฏ ุจุฎุณุงุฑุฉ ูุจูุนุงุช ูููุชูุง {potential_loss} ุฑูุงู ุฎูุงู ุฃุณุจูุน.")
    elif order_cost > 300:
        st.warning("**ุชุญููู ุงูุชูุงููู:** ุชูููุฉ ุงูุดุญู ูุฑุชูุนุฉ ุฌุฏุงูุ ููุฐุง ูู ุงูุณุจุจ ูู ุฃู ุงููุธุงู ููุตุญู ุจุทูุจ ูููุฉ ูุจูุฑุฉ (EOQ) ูุชูููู ุนุฏุฏ ูุฑุงุช ุงูุดุญู.")
    else:
        st.success("**ุชุญููู ุงูุงุณุชูุฑุงุฑ:** ุงููุนุทูุงุช ุงูุญุงููุฉ ูุชูุงุฒูุฉุ ููุง ููุฌุฏ ูุฏุฑ ูุงูู ูุจูุฑ ูู ุชูุงููู ุงูุชุฎุฒูู.")

with col_solutions:
    st.markdown("### ๐๏ธ ูุงุฐุง ุชูุนู ุงูุขูุ")
    if days_left < 5:
        st.write(f"1๏ธโฃ **ุงุทูุจ ููุฑุงู:** ูู ุจุฅุตุฏุงุฑ ุฃูุฑ ุดุฑุงุก ุจู {int(eoq)} ูุญุฏุฉ.")
        st.write("2๏ธโฃ **ุชูุงุตู ูุน ุงูููุฑุฏ:** ุงุทูุจ ุดุญูุฉ ูุนุฌูุฉ ูุชุฌูุจ ุชููู ุงููุจูุนุงุช.")
    else:
        st.write("1๏ธโฃ **ุฑุงูุจ ุงูุณูู:** ุงุจุญุซ ุนู ููุฑุฏูู ุจุชูุงููู ุดุญู ุฃูู ูุฒูุงุฏุฉ ุตุงูู ุฑุจุญู.")
        st.write("2๏ธโฃ **ุชุญุณูู ุงูุชุฎุฒูู:** ุฅุฐุง ูุงูุช ุชูููุฉ ุงูุชุฎุฒูู ูุฑุชูุนุฉุ ููุฑ ูู ูุธุงู (Just-In-Time).")

# 6. ุงูุฑุณู ุงูุจูุงูู ููุชูุถูุญ
st.markdown("---")
st.subheader("๐ ุชููุนุงุช ุญุฑูุฉ ุงููุฎุฒูู")
time = np.arange(0, int(days_left) + 5)
stock_trend = [max(0, current_stock - (daily_sales * t)) for t in time]
fig = px.line(x=time, y=stock_trend, labels={'x':'ุงูุฃูุงู ุงููุงุฏูุฉ', 'y':'ูููุฉ ุงููุฎุฒูู'}, title="ูุชู ุณูุตู ูุฎุฒููู ููุตูุฑุ")
fig.add_hline(y=0, line_dash="dash", line_color="red")
st.plotly_chart(fig, use_container_width=True)
