import streamlit as st
import pandas as pd
import numpy as np
import plotly.express as px

# 1. ุฅุนุฏุงุฏุงุช ุงูุตูุญุฉ ุงูุตูุงุนูุฉ
st.set_page_config(page_title="Ecotrak Industrial Pro", layout="wide", page_icon="๐ญ")

st.title("๐ญ Ecotrak AI: ูุธุงู ุฅุฏุงุฑุฉ ุงูุนูููุงุช ุงูุตูุงุนูุฉ")
st.markdown("---")

# 2. ููุญุฉ ุงูุชุญูู ุงูุฌุงูุจูุฉ (ูุฏุฎูุงุช ุงููุตูุน)
st.sidebar.header("โ๏ธ ูุนุงููุฑ ุฎุท ุงูุฅูุชุงุฌ")
capacity_daily = st.sidebar.number_input("ุงููุฏุฑุฉ ุงูุฅูุชุงุฌูุฉ ุงูููููุฉ (ูุทุนุฉ)", value=200)
labor_cost_hour = st.sidebar.number_input("ุชูููุฉ ุงูุนูุงูุฉ/ุณุงุนุฉ (ุฑูุงู)", value=150)
downtime_hours = st.sidebar.slider("ุณุงุนุงุช ุงูุชุนุทู ุงููุชููุนุฉ (ุดูุฑูุงู)", 0, 50, 5)

st.sidebar.markdown("---")
st.sidebar.header("๐ฆ ุจูุงูุงุช ุงูููุชุฌ ูุงููุฎุฒูู")
price = st.sidebar.number_input("ุณุนุฑ ุจูุน ุงูููุชุฌ", value=1200)
daily_demand = st.sidebar.slider("ุงูุทูุจ ุงููููู ูู ุงูุนููุงุก", 1, 300, 150)
current_stock = st.sidebar.number_input("ุงููุฎุฒูู ุงูุญุงูู", value=500)

# 3. ุงูุญุณุงุจุงุช ุงูุตูุงุนูุฉ ุงููุชูุฏูุฉ
# ุญุณุงุจ ููุงุกุฉ ุงูุฅูุชุงุฌ
efficiency = (daily_demand / capacity_daily) * 100
# ุญุณุงุจ ุชูููุฉ ุงูุชุนุทู ุงูุดูุฑูุฉ
total_downtime_cost = downtime_hours * (labor_cost_hour + (daily_demand/24 * price))
# ุญุณุงุจ ุฃูุงู ุชุบุทูุฉ ุงููุฎุฒูู
days_to_stockout = current_stock / daily_demand

# 4. ุนุฑุถ ูุคุดุฑุงุช ุงูุฃุฏุงุก (Industrial KPIs)
m1, m2, m3, m4 = st.columns(4)
m1.metric("ููุงุกุฉ ุงูุชุดุบูู (OEE)", f"{efficiency:.1f}%")
m2.metric("ุชูููุฉ ุงูุชุนุทู ุงููุชููุนุฉ", f"{total_downtime_cost:,.0f} ุฑูุงู")
m3.metric("ุฃูุงู ุชุบุทูุฉ ุงููุฎุฒูู", f"{int(days_to_stockout)} ููู")
m4.metric("ููุทุฉ ุงูุชุนุงุฏู (Daily)", f"{int(daily_demand * 0.8)} ูุทุนุฉ")

st.markdown("---")

# 5. ุชุญููู ุงููุณุชุดุงุฑ ุงูุตูุงุนู
st.subheader("๐ง ุงูุชุญููู ุงูุงุณุชุฑุงุชูุฌู ูููุตูุน")
c1, c2 = st.columns(2)

with c1:
    st.info("๐ **ุชุดุฎูุต ุฎุท ุงูุฅูุชุงุฌ:**")
    if efficiency > 90:
        st.warning("โ๏ธ **ุชุญุฐูุฑ ุนูู ุฒุฌุงุฌุฉ:** ุงููุตูุน ูุนูู ูุฑูุจุงู ูู ุทุงูุชู ุงููุตูู. ุฃู ุนุทู ุจุณูุท ุณูุคุฏู ูุชุฃุฎุฑ ุงูุทูุจูุงุช.")
    elif efficiency < 50:
        st.error("๐ **ูุฏุฑ ูู ุงูููุงุฑุฏ:** ูุฏุฑุฉ ุงููุตูุน ูุนุทูุฉ. ุฃูุช ุชุฏูุน ุชูุงููู ุซุงุจุชุฉ ูุนูุงูุฉ ููุนุฏุงุช ูุง ุชูุชุฌ ููุงูุชูุง.")
    
    if total_downtime_cost > 10000:
        st.write(f"- **ุฎุณุงุฑุฉ ูุฎููุฉ:** ุณุงุนุงุช ุงูุชุนุทู ({downtime_hours}) ุชุณุจุจ ูุฒููุงู ูุงููุงู ููุฏุฑ ุจู {total_downtime_cost} ุฑูุงู.")

with c2:
    st.success("๐๏ธ **ุฎุทุฉ ุงูุนูู ุงูููุชุฑุญุฉ:**")
    if days_to_stockout < 5:
        st.write("1. **ุฑูุน ูุชูุฑุฉ ุงูุฅูุชุงุฌ:** ูู ุจุชูุนูู ูุฑุฏูุฉ ุฅุถุงููุฉ ููุฑุงู ูุชุบุทูุฉ ุงูููุต.")
    if efficiency > 90:
        st.write("2. **ุชูุณุนุฉ:** ุงุจุฏุฃ ุจุฏุฑุงุณุฉ ุดุฑุงุก ูุนุฏุงุช ุฌุฏูุฏุฉ ูุฑูุน ุงููุฏุฑุฉ ุงูุฅูุชุงุฌูุฉ.")
    st.write("3. **ุตูุงูุฉ ููุงุฆูุฉ:** ููู ุณุงุนุงุช ุงูุชุนุทู ุนุจุฑ ุฌุฏููุฉ ุตูุงูุฉ ุฏูุฑูุฉ ูููุนุฏุงุช ุงูุญูููุฉ.")

# 6. ุงูุฑุณูู ุงูุจูุงููุฉ (ุชุญููู ุงููุฌูุฉ)
st.markdown("---")
st.subheader("๐ ุชุญููู ุงููุฌูุฉ ุจูู ุงูุฅูุชุงุฌ ูุงูุทูุจ")
chart_data = pd.DataFrame({
    'ุงููุฆุฉ': ['ุงููุฏุฑุฉ ุงููุตูู', 'ุงูุทูุจ ุงููุนูู', 'ุงูุฅูุชุงุฌ ุงูุญุงูู'],
    'ุงููููุฉ': [capacity_daily, daily_demand, min(capacity_daily, daily_demand)]
})
fig = px.bar(chart_data, x='ุงููุฆุฉ', y='ุงููููุฉ', color='ุงููุฆุฉ', 
             title="ูู ูุตูุนู ูุงุฏุฑ ุนูู ุชูุจูุฉ ุงูุณููุ")
st.plotly_chart(fig, use_container_width=True)
